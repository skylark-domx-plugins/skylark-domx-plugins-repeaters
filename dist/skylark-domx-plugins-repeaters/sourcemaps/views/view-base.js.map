{"version":3,"sources":["views/view-base.js"],"names":["define","langx","noder","$","Evented","inherit","klassName","options","controlsClass","fullScreen","_construct","repeater","hasControls","that","this","initOptions","container","on","e","hasClass","removeClass","addClass","_create$Item","template","itemData","end","start","val","invalid","search","indexOf","trim","substring","undefined","ctor","constructor","cache","defaults","ctors","unshift","Plugin","superclass","i","length","prototype","hasOwnProperty","mixin","Object","defineProperty","value","close","getValue","getSelectedItems","cleared","selected","dataOptions","enabled","helpers","addItem","$parent","response","action","item","render","before","addBefore","$dataContainer","find","$container","renderItem","subset","objectAndPropsToRepeatOn","repeat","split","objectToRepeatOn","data","propsToRepeatOn","slice","prop","console","warn","subItemIndex","addSubItem","index","after","addAfter"],"mappings":"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","file":"../../views/view-base.js","sourcesContent":["define([\r\n\t\"skylark-langx/langx\",\r\n\t\"skylark-domx-noder\",\r\n\t\"skylark-domx-query\"\r\n],function(langx,noder,$) {\r\n\r\n\tvar ViewBase = langx.Evented.inherit({\r\n\t    klassName: \"ViewBase\",\r\n\r\n\t    options : {\r\n\t      // The class to add when the gallery controls are visible:\r\n\t      controlsClass: \"skylarkui-repeater-controls\",\r\n\t\t    // Defines if the gallery should open in fullscreen mode:\r\n\t\t    fullScreen: false\r\n\r\n\t    },\r\n      _construct : function (repeater,options) {\r\n          var that = this,\r\n            hasControls;\r\n          this.repeater = repeater;\r\n          this.initOptions(options);\r\n          if (this.options.fullScreen) {\r\n            noder.fullScreen(this.container[0]);\r\n          }\r\n          this.repeater.on(\"item.running\",function(e){\r\n              if (that.container.hasClass(that.options.controlsClass)) {\r\n                hasControls = true\r\n                that.container.removeClass(that.options.controlsClass);\r\n              } else {\r\n                hasControls = false\r\n              }\r\n          });\r\n\r\n          this.repeater.on(\"item.running\",function(e){\r\n              if (hasControls) {\r\n                that.container.addClass(that.options.controlsClass);\r\n              }\r\n          });\r\n      },\r\n\r\n    \t_create$Item : function (template,itemData) {\r\n        \tvar invalid = false;\r\n\r\n        \tfunction replace() {\r\n            \tvar end, start, val;\r\n\r\n            \tstart = template.indexOf('{{');\r\n            \tend = template.indexOf('}}', start + 2);\r\n\r\n            \tif (start > -1 && end > -1) {\r\n                \tval = langx.trim(template.substring(start + 2, end));\r\n                \tval = (itemData[val] !== undefined) ? itemData[val] : '';\r\n                \ttemplate = template.substring(0, start) + val + template.substring(end + 2);\r\n            \t} else {\r\n                \tinvalid = true;\r\n            \t}\r\n       \t\t}\r\n\r\n        \twhile (!invalid && template.search('{{') >= 0) {\r\n            \treplace(template);\r\n        \t}\r\n\r\n        \treturn $(template);\r\n    \t},\t    \r\n\t    \r\n\t    //initOptions: function (options) {\r\n\t    //  // Create a copy of the prototype options:\r\n\t    //  this.options = langx.mixin({}, this.options,options);\r\n\t    //},\r\n\r\n      initOptions : function(options) {\r\n        var ctor = this.constructor,\r\n            cache = ctor.cache = ctor.cache || {},\r\n            defaults = cache.defaults;\r\n        if (!defaults) {\r\n          var  ctors = [];\r\n          do {\r\n            ctors.unshift(ctor);\r\n            if (ctor === Plugin) {\r\n              break;\r\n            }\r\n            ctor = ctor.superclass;\r\n          } while (ctor);\r\n\r\n          defaults = cache.defaults = {};\r\n          for (var i=0;i<ctors.length;i++) {\r\n            ctor = ctors[i];\r\n            if (ctor.prototype.hasOwnProperty(\"options\")) {\r\n              langx.mixin(defaults,ctor.prototype.options,true);\r\n            }\r\n            if (ctor.hasOwnProperty(\"options\")) {\r\n              langx.mixin(defaults,ctor.options,true);\r\n            }\r\n          }\r\n        }\r\n        Object.defineProperty(this,\"options\",{\r\n          value :langx.mixin({},defaults,options,true)\r\n        });\r\n\r\n        //return this.options = langx.mixin({},defaults,options);\r\n        return this.options;\r\n      },\r\n\r\n\r\n\t    close: function () {\r\n      \t\tif (noder.fullScreen() === this.container[0]) {\r\n        \t\tnoder.fullScreen(false);\r\n      \t\t}\r\n    \t},\r\n\r\n    \tgetValue : function() {\r\n    \t\treturn this.getSelectedItems();\r\n    \t},\r\n\r\n    \tcleared : function() {\r\n\r\n    \t},\r\n\r\n    \tselected : function() {\r\n\r\n    \t},\r\n\r\n\t    dataOptions: function (options) {\r\n\t    \treturn options;\r\n\t    },\r\n\r\n\t    enabled : function(helpers){\r\n\t    \t\r\n\t    },\r\n\r\n      addItem : function addItem ($parent, response) {\r\n        var action;\r\n        if (response) {\r\n          action = (response.action) ? response.action : 'append';\r\n          if (action !== 'none' && response.item !== undefined) {\r\n            var $container = (response.container !== undefined) ? $(response.container) : $parent;\r\n            $container[action](response.item);\r\n          }\r\n        }\r\n      },\r\n\r\n      render : function(helpers) {\r\n        if (this.before) {\r\n          var addBefore = this.before(helpers);\r\n          this.addItem(helpers.container, addBefore);\r\n        }\r\n\r\n        var $dataContainer = helpers.container.find('[data-container=\"true\"]:last');\r\n        var $container = ($dataContainer.length > 0) ? $dataContainer : helpers.container;\r\n\r\n        // It appears that the following code would theoretically allow you to pass a deeply\r\n        // nested value to \"repeat on\" to be added to the repeater.\r\n        // eg. `data.foo.bar.items`\r\n        if (this.renderItem) {\r\n          var subset;\r\n          var objectAndPropsToRepeatOnString = this.repeat || 'data.items';\r\n          var objectAndPropsToRepeatOn = objectAndPropsToRepeatOnString.split('.');\r\n          var objectToRepeatOn = objectAndPropsToRepeatOn[0];\r\n\r\n          if (objectToRepeatOn === 'data' || objectToRepeatOn === 'this') {\r\n            subset = (objectToRepeatOn === 'this') ? this : helpers.data;\r\n\r\n            // Extracts subset from object chain (get `items` out of `foo.bar.items`). I think....\r\n            var propsToRepeatOn = objectAndPropsToRepeatOn.slice(1);\r\n            for (var prop = 0; prop < propsToRepeatOn.length; prop++) {\r\n              if (subset[propsToRepeatOn[prop]] !== undefined) {\r\n                subset = subset[propsToRepeatOn[prop]];\r\n              } else {\r\n                subset = [];\r\n                console.warn('WARNING: Repeater unable to find property to iterate renderItem on.');\r\n                break;\r\n              }\r\n            }\r\n\r\n            for (var subItemIndex = 0; subItemIndex < subset.length; subItemIndex++) {\r\n              var addSubItem = this.renderItem({\r\n                container: $container,\r\n                data: helpers.data,\r\n                index: subItemIndex,\r\n                subset: subset\r\n              });\r\n              this.addItem($container, addSubItem);\r\n            }\r\n          } else {\r\n            console.warn('WARNING: Repeater plugin \"repeat\" value must start with either \"data\" or \"this\"');\r\n          }\r\n        }\r\n\r\n        if (this.after) {\r\n          var addAfter = this.after(helpers);\r\n          this.addItem(helpers.container, addAfter);\r\n        }    \r\n      }\r\n\r\n\t});\r\n\r\n\treturn ViewBase;\r\n});\r\n"]}
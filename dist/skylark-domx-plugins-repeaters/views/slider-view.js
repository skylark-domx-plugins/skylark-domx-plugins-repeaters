/**
 * skylark-domx-plugins-repeaters - The skylark repeater plugin library
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-domx-plugins/skylark-domx-plugins-repeaters/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-domx-noder","skylark-domx-query","../view-type-registry","./view-base"],function(i,e,a,t,s){"use strict";var n=s.inherit({klassName:"SliderView",options:{container:null,slidesContainer:"div.slides",titleElement:"h3",displayClass:"slider-display",singleClass:"slider-single",leftEdgeClass:"slider-left",rightEdgeClass:"slider-right",playingClass:"slider-playing",slideClass:"slide",slideLoadingClass:"slide-loading",slideErrorClass:"slide-error",slideContentClass:"slide-content",toggleClass:"toggle",prevClass:"prev",nextClass:"next",closeClass:"close",playPauseClass:"play-pause",displayTransition:!0,clearSlides:!0,toggleControlsOnReturn:!0,toggleControlsOnSlideClick:!0,toggleSlideshowOnSpace:!0,enableKeyboardNavigation:!0,closeOnEscape:!0,closeOnSlideClick:!0,closeOnSwipeUpOrDown:!0,emulateTouchEvents:!0,stopTouchEventsPropagation:!1,hidePageScrollbars:!1,disableScroll:!0,carousel:!1,continuous:!0,unloadElements:!0,startSlideshow:!0,slideshowInterval:5e3,index:0,preloadRange:2,transitionSpeed:400,slideshowTransitionSpeed:void 0,event:void 0,onslide:void 0,onslideend:void 0,onslidecomplete:void 0,indicatorContainer:"ol",activeIndicatorClass:"active",thumbnailProperty:"ThumbnailImage",thumbnailIndicators:!0,indicators:{hidePageScrollbars:!1,indicatorContainer:"ol",activeIndicatorClass:"active",thumbnailProperty:"thumbnail",thumbnailIndicators:!0},template:'<div class="repeater-slider"><div class="slides"></div><h3 class="title"></h3><a class="prev">‹</a><a class="next">›</a><a class="play-pause"></a><ol class="indicator"></ol></div>',item:{template:'<img height="75" src="{{ThumbnailImage}}" width="65"/>'}},support:function(e){var t,n={touch:void 0!==window.ontouchstart||window.DocumentTouch&&document instanceof DocumentTouch},i={webkitTransition:{end:"webkitTransitionEnd",prefix:"-webkit-"},MozTransition:{end:"transitionend",prefix:"-moz-"},OTransition:{end:"otransitionend",prefix:"-o-"},transition:{end:"transitionend",prefix:""}};for(t in i)if(i.hasOwnProperty(t)&&void 0!==e.style[t]){n.transition=i[t],n.transition.name=t;break}function s(){var t,i,s=n.transition;document.body.appendChild(e),s&&(t=s.name.slice(0,-9)+"ransform",void 0!==e.style[t])&&(e.style[t]="translateZ(0)",i=window.getComputedStyle(e).getPropertyValue(s.prefix+"transform"),n.transform={prefix:s.prefix,name:t,translate:!0,translateZ:!!i&&"none"!==i}),void 0!==e.style.backgroundSize&&(n.backgroundSize={},e.style.backgroundSize="contain",n.backgroundSize.contain="contain"===window.getComputedStyle(e).getPropertyValue("background-size"),e.style.backgroundSize="cover",n.backgroundSize.cover="cover"===window.getComputedStyle(e).getPropertyValue("background-size")),document.body.removeChild(e)}return document.body?s():a(document).on("DOMContentLoaded",s),n}(document.createElement("div")),requestAnimationFrame:window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame,cancelAnimationFrame:window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame,render:function(t){this.container=this.repeater.$canvas.find(".repeater-slider"),this.container.length<1&&(this.container=a(this.options.template),this.repeater.$canvas.append(this.container)),this.list=t.data.items,this.num=this.list.length,this.initStartIndex(),this.initView(),this.initEventListeners(),this.onslide(this.index),this.ontransitionend(),this.options.startSlideshow&&this.play()},slide:function(t,i){window.clearTimeout(this.timeout);var s,e,n,o=this.index;if(o!==t&&1!==this.num){if(i=i||this.options.transitionSpeed,this.support.transform){for(this.options.continuous||(t=this.circle(t)),s=Math.abs(o-t)/(o-t),this.options.continuous&&(e=s,(s=-this.positions[this.circle(t)]/this.slideWidth)!==e)&&(t=-s*this.num+t),n=Math.abs(o-t)-1;n;)this.move(this.circle((o<t?t:o)- --n-1),this.slideWidth*s,0);t=this.circle(t),this.move(o,this.slideWidth*s,i),this.move(t,0,i),this.options.continuous&&this.move(this.circle(t-s),-this.slideWidth*s,0)}else t=this.circle(t),this.animate(o*-this.slideWidth,t*-this.slideWidth,i);this.onslide(t)}},getIndex:function(){return this.index},getNumber:function(){return this.num},prev:function(){(this.options.continuous||this.index)&&this.slide(this.index-1)},next:function(){(this.options.continuous||this.index<this.num-1)&&this.slide(this.index+1)},circle:function(t){return(this.num+t%this.num)%this.num},move:function(t,i,s){this.translateX(t,i,s),this.positions[t]=i},translate:function(t,i,s,e){var t=this.slides[t].style,n=this.support.transition,o=this.support.transform;t[n.name+"Duration"]=e+"ms",t[o.name]="translate("+i+"px, "+s+"px)"+(o.translateZ?" translateZ(0)":"")},translateX:function(t,i,s){this.translate(t,i,0,s)},translateY:function(t,i,s){this.translate(t,0,i,s)},animate:function(i,s,e){var n,o,a;e?(n=this,o=(new Date).getTime(),a=window.setInterval(function(){var t=(new Date).getTime()-o;e<t?(n.slidesContainer[0].style.left=s+"px",n.ontransitionend(),window.clearInterval(a)):n.slidesContainer[0].style.left=(s-i)*(Math.floor(t/e*100)/100)+i+"px"},4)):this.slidesContainer[0].style.left=s+"px"},play:function(t){var s=this;window.clearTimeout(this.timeout),this.interval=t||this.options.slideshowInterval,this.timeout=this.setTimeout(!this.requestAnimationFrame&&this.slide||function(t,i){s.animationFrameId=s.requestAnimationFrame.call(window,function(){s.slide(t,i)})},[this.index+1,this.options.slideshowTransitionSpeed],this.interval),this.container.addClass(this.options.playingClass)},pause:function(){window.clearTimeout(this.timeout),this.interval=null,this.cancelAnimationFrame&&(this.cancelAnimationFrame.call(window,this.animationFrameId),this.animationFrameId=null),this.container.removeClass(this.options.playingClass)},add:function(t){var i;for(t.concat||(t=Array.prototype.slice.call(t)),this.list.concat||(this.list=Array.prototype.slice.call(this.list)),this.list=this.list.concat(t),this.num=this.list.length,2<this.num&&null===this.options.continuous&&(this.options.continuous=!0,this.container.removeClass(this.options.leftEdgeClass)),this.container.removeClass(this.options.rightEdgeClass).removeClass(this.options.singleClass),i=this.num-t.length;i<this.num;i+=1)this.addSlide(i),this.positionSlide(i);this.positions.length=this.num,this.initSlides(!0)},resetSlides:function(){this.slidesContainer.empty(),this.unloadAllSlides(),this.slides=[],this.indicatorContainer.empty(),this.indicators=[]},preventDefault:function(t){t.preventDefault?t.preventDefault():t.returnValue=!1},stopPropagation:function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},onresize:function(){this.initSlides(!0)},onmousedown:function(t){t.which&&1===t.which&&"VIDEO"!==t.target.nodeName&&"AUDIO"!==t.target.nodeName&&(t.preventDefault(),(t.originalEvent||t).touches=[{pageX:t.pageX,pageY:t.pageY}],this.ontouchstart(t))},onmousemove:function(t){this.touchStart&&((t.originalEvent||t).touches=[{pageX:t.pageX,pageY:t.pageY}],this.ontouchmove(t))},onmouseup:function(t){this.touchStart&&(this.ontouchend(t),delete this.touchStart)},onmouseout:function(t){var i,s;this.touchStart&&(i=t.target,(s=t.relatedTarget)&&(s===i||e.contains(i,s))||this.onmouseup(t))},ontouchstart:function(t){this.options.stopTouchEventsPropagation&&this.stopPropagation(t);t=(t.originalEvent||t).touches[0];this.touchStart={x:t.pageX,y:t.pageY,time:Date.now()},this.isScrolling=void 0,this.touchDelta={}},ontouchmove:function(t){this.options.stopTouchEventsPropagation&&this.stopPropagation(t);var i,s,e=(t.originalEvent||t).touches[0],n=(t.originalEvent||t).scale,o=this.index;if(!(1<e.length||n&&1!==n))if(this.options.disableScroll&&t.preventDefault(),this.touchDelta={x:e.pageX-this.touchStart.x,y:e.pageY-this.touchStart.y},i=this.touchDelta.x,void 0===this.isScrolling&&(this.isScrolling=this.isScrolling||Math.abs(i)<Math.abs(this.touchDelta.y)),this.isScrolling)this.translateY(o,this.touchDelta.y+this.positions[o],0);else for(t.preventDefault(),window.clearTimeout(this.timeout),this.options.continuous?s=[this.circle(o+1),o,this.circle(o-1)]:(this.touchDelta.x=i/=!o&&0<i||o===this.num-1&&i<0?Math.abs(i)/this.slideWidth+1:1,s=[o],o&&s.push(o-1),o<this.num-1&&s.unshift(o+1));s.length;)o=s.pop(),this.translateX(o,i+this.positions[o],0)},ontouchend:function(t){this.options.stopTouchEventsPropagation&&this.stopPropagation(t);var i,s,t=this.index,e=this.options.transitionSpeed,n=this.slideWidth,o=Number(Date.now()-this.touchStart.time)<250,a=o&&20<Math.abs(this.touchDelta.x)||Math.abs(this.touchDelta.x)>n/2,h=!t&&0<this.touchDelta.x||t===this.num-1&&this.touchDelta.x<0;a||!this.options.closeOnSwipeUpOrDown||o&&20<Math.abs(this.touchDelta.y)||(Math.abs(this.touchDelta.y),this.slideHeight);this.options.continuous&&(h=!1),o=this.touchDelta.x<0?-1:1,this.isScrolling?this.translateY(t,0,e):a&&!h?(a=t+o,h=t-o,i=n*o,s=-n*o,this.options.continuous?(this.move(this.circle(a),i,0),this.move(this.circle(t-2*o),s,0)):0<=a&&a<this.num&&this.move(a,i,0),this.move(t,this.positions[t]+i,e),this.move(this.circle(h),this.positions[this.circle(h)]+i,e),t=this.circle(h),this.onslide(t)):this.options.continuous?(this.move(this.circle(t-1),-n,e),this.move(t,0,e),this.move(this.circle(t+1),n,e)):(t&&this.move(t-1,-n,e),this.move(t,0,e),t<this.num-1&&this.move(t+1,n,e))},ontouchcancel:function(t){this.touchStart&&(this.ontouchend(t),delete this.touchStart)},ontransitionend:function(t){var i=this.slides[this.index];t&&i!==t.target||(this.interval&&this.play(),this.setTimeout(this.options.onslideend,[this.index,i]))},onkeydown:function(t){switch(t.which||t.keyCode){case 13:this.options.toggleControlsOnReturn&&(this.preventDefault(t),this.toggleControls());break;case 27:break;case 32:this.options.toggleSlideshowOnSpace&&(this.preventDefault(t),this.toggleSlideshow());break;case 37:this.options.enableKeyboardNavigation&&(this.preventDefault(t),this.prev());break;case 39:this.options.enableKeyboardNavigation&&(this.preventDefault(t),this.next())}},handleClick:function(t){var i=this.options,s=t.target||t.srcElement,e=s.parentNode;function n(t){return a(s).hasClass(t)||a(e).hasClass(t)}e===this.indicatorContainer[0]?(this.preventDefault(t),this.slide(this.getNodeIndex(s))):e.parentNode===this.indicatorContainer[0]?(this.preventDefault(t),this.slide(this.getNodeIndex(e))):n(i.toggleClass)?(this.preventDefault(t),this.toggleControls()):n(i.prevClass)?(this.preventDefault(t),this.prev()):n(i.nextClass)?(this.preventDefault(t),this.next()):n(i.playPauseClass)?(this.preventDefault(t),this.toggleSlideshow()):e===this.slidesContainer[0]?i.toggleControlsOnSlideClick&&(this.preventDefault(t),this.toggleControls()):e.parentNode&&e.parentNode===this.slidesContainer[0]&&i.toggleControlsOnSlideClick&&(this.preventDefault(t),this.toggleControls())},onclick:function(t){if(!(this.options.emulateTouchEvents&&this.touchDelta&&(20<Math.abs(this.touchDelta.x)||20<Math.abs(this.touchDelta.y))))return this.handleClick(t);delete this.touchDelta},updateEdgeClasses:function(t){t?this.container.removeClass(this.options.leftEdgeClass):this.container.addClass(this.options.leftEdgeClass),t===this.num-1?this.container.addClass(this.options.rightEdgeClass):this.container.removeClass(this.options.rightEdgeClass)},handleSlide:function(t){this.options.continuous||this.updateEdgeClasses(t),this.loadElements(t),this.options.unloadElements&&this.unloadElements(t),this.setTitle(t),this.setActiveIndicator(t)},onslide:function(t){this.index=t,this.handleSlide(t),this.setTimeout(this.options.onslide,[t,this.slides[t]])},setTitle:function(t){var t=this.slides[t].firstChild,t=t.title||t.alt,i=this.titleElement;i.length&&(this.titleElement.empty(),t)&&i[0].appendChild(document.createTextNode(t))},setTimeout:function(t,i,s){var e=this;return t&&window.setTimeout(function(){t.apply(e,i||[])},s||0)},createElement:function(t,i){t=this._create$Item(this.options.item.template,t);return t.find("img").on("load error",i),t.addClass(this.options.slideContentClass),t},loadElement:function(t){this.elements[t]||(this.slides[t].firstChild?this.elements[t]=a(this.slides[t]).hasClass(this.options.slideErrorClass)?3:2:(this.elements[t]=1,a(this.slides[t]).append(this.createElement(this.list[t],this.proxyListener))))},loadElements:function(t){for(var i=Math.min(this.num,2*this.options.preloadRange+1),s=t,e=0;e<i;e+=1)s=this.circle(s+=e*(e%2==0?-1:1)),this.loadElement(s)},unloadElements:function(t){var i,s;for(i in this.elements)this.elements.hasOwnProperty(i)&&(s=Math.abs(t-i))>this.options.preloadRange&&s+this.options.preloadRange<this.num&&(this.unloadSlide(i),delete this.elements[i])},createIndicator:function(t){var i,s=this.repeater,e=this.indicatorPrototype.cloneNode(!1),n=s.getItemProperty(t,"title"),o=this.options.thumbnailProperty;return this.options.thumbnailIndicators&&(i=void 0===(i=o?s.getItemProperty(t,o):i)&&(s=t.getElementsByTagName&&a(t).find("img")[0])?s.src:i)&&(e.style.backgroundImage='url("'+i+'")'),n&&(e.title=n),e},addIndicator:function(t){var i;this.indicatorContainer.length&&((i=this.createIndicator(this.list[t])).setAttribute("data-index",t),this.indicatorContainer[0].appendChild(i),this.indicators.push(i))},setActiveIndicator:function(t){this.indicators&&(this.activeIndicator&&this.activeIndicator.removeClass(this.options.activeIndicatorClass),this.activeIndicator=a(this.indicators[t]),this.activeIndicator.addClass(this.options.activeIndicatorClass))},addSlide:function(t){var i=this.slidePrototype.cloneNode(!1);i.setAttribute("data-index",t),this.slidesContainer[0].appendChild(i),this.slides.push(i),this.addIndicator(t)},positionSlide:function(t){var i=this.slides[t];i.style.width=this.slideWidth+"px",this.support.transform&&(i.style.left=t*-this.slideWidth+"px",this.move(t,this.index>t?-this.slideWidth:this.index<t?this.slideWidth:0,0))},initSlides:function(t){var i,s;for(t||(this.indicatorContainer=this.container.find(this.options.indicatorContainer),this.indicatorContainer.length&&(this.indicatorPrototype=document.createElement("li"),this.indicators=this.indicatorContainer[0].children),this.positions=[],this.positions.length=this.num,this.elements={},this.imagePrototype=document.createElement("img"),this.elementPrototype=document.createElement("div"),this.slidePrototype=document.createElement("div"),a(this.slidePrototype).addClass(this.options.slideClass),this.slides=this.slidesContainer[0].children,i=this.options.clearSlides||this.slides.length!==this.num),this.slideWidth=this.container[0].clientWidth,this.slideHeight=this.container[0].clientHeight,this.slidesContainer[0].style.width=this.num*this.slideWidth+"px",i&&this.resetSlides(),s=0;s<this.num;s+=1)i&&this.addSlide(s),this.positionSlide(s);this.options.continuous&&this.support.transform&&(this.move(this.circle(this.index-1),-this.slideWidth,0),this.move(this.circle(this.index+1),this.slideWidth,0)),this.support.transform||(this.slidesContainer[0].style.left=this.index*-this.slideWidth+"px")},unloadSlide:function(t){var t=this.slides[t],i=t.firstChild;null!==i&&t.removeChild(i)},unloadAllSlides:function(){for(var t=0,i=this.slides.length;t<i;t++)this.unloadSlide(t)},toggleControls:function(){var t=this.options.controlsClass;this.container.hasClass(t)?this.container.removeClass(t):this.container.addClass(t)},toggleSlideshow:function(){this.interval?this.pause():this.play()},getNodeIndex:function(t){return parseInt(t.getAttribute("data-index"),10)},initStartIndex:function(){var t,i=this.repeater,s=this.options.index;if(s&&"number"!=typeof s)for(t=0;t<this.num;t+=1)if(this.list[t]===s||i.getItemUrl(this.list[t])===i.getItemUrl(s)){s=t;break}this.index=this.circle(parseInt(s,10)||0)},initEventListeners:function(){var s=this,t=this.slidesContainer;function i(t){var i=s.support.transition&&s.support.transition.end===t.type?"transitionend":t.type;s["on"+i](t)}a(window).on("resize",i),a(document.body).on("keydown",i),this.container.on("click",i),this.support.touch?t.on("touchstart touchmove touchend touchcancel",i):this.options.emulateTouchEvents&&this.support.transition&&t.on("mousedown mousemove mouseup mouseout",i),this.support.transition&&t.on(this.support.transition.end,i),this.proxyListener=i},destroyEventListeners:function(){var t=this.slidesContainer,i=this.proxyListener;a(window).off("resize",i),a(document.body).off("keydown",i),this.container.off("click",i),this.support.touch?t.off("touchstart touchmove touchend touchcancel",i):this.options.emulateTouchEvents&&this.support.transition&&t.off("mousedown mousemove mouseup mouseout",i),this.support.transition&&t.off(this.support.transition.end,i)},initView:function(){if(this.slidesContainer=this.container.find(this.options.slidesContainer).first(),!this.slidesContainer.length)return console.log("blueimp Gallery: Slides container not found.",this.options.slidesContainer),!1;this.titleElement=this.container.find(this.options.titleElement).first(),1===this.num&&this.container.addClass(this.options.singleClass),this.options.hidePageScrollbars&&(this.bodyOverflowStyle=document.body.style.overflow,document.body.style.overflow="hidden"),this.container[0].style.display="block",this.initSlides(),this.container.addClass(this.options.displayClass)},initOptions:function(t){this.overrided(i.mixin({},n.prototype.options,t)),this.num<3&&(this.options.continuous=!!this.options.continuous&&null),this.support.transition||(this.options.emulateTouchEvents=!1),this.options.event&&this.preventDefault(this.options.event)}});return t.slider={name:"slider",ctor:n},n});
//# sourceMappingURL=../sourcemaps/views/slider-view.js.map
